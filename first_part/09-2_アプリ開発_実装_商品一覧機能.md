# FruitShop 商品一覧の実装

## データベース設計

### products テーブルの作成

```ruby
# products テーブルを作成
create_table :products do |t|
  t.string :name, null: false  # 商品名（必須）
  t.text :description          # 商品説明
  t.integer :price, null: false # 価格
  t.timestamps                 # 作成日時と更新日時
end
```

## 1. Model の実装

## 商品一覧を表示するために `Product` モデルを作成
```ruby
class Product < ApplicationRecord
  # ActiveStorage を利用して画像を紐づけ
  has_one_attached :image

  # 商品画像を取得するメソッド
  def get_image
    unless image.attached?
      # デフォルト画像を設定
      file_path = Rails.root.join('app/assets/images/no_image.jpg')
      image.attach(io: File.open(file_path), filename: 'default-image.jpg', content_type: 'image/jpeg')
    end
    image
  end
end
```

この `get_image` メソッドは、商品画像が設定されていない場合に `no_image.jpg` を ActiveStorage に格納し、デフォルト画像として利用するものです。

## 2. 画像が存在しない場合に表示する画像を ActiveStorage に格納する

# ActiveStorage をセットアップするためのコマンド
```sh
rails active_storage:install
rails db:migrate
```

これにより `active_storage_blobs` テーブルが作成され、画像を ActiveStorage に格納できるようになります。

## 3. Controller の実装

# 商品一覧を取得する `index` アクションを追加
```ruby
class ProductsController < ApplicationController
  def index
    @products = Product.all  # 全ての商品を取得
  end
end
```

## 4. View の実装

# 商品一覧を表示する `index.html.erb`
```erb
<% @products.each do |product| %>
  <div>
    <%# 商品画像を表示（存在しない場合はデフォルト画像） %>
    <%= image_tag product.get_image, size: "200x200" %>
    <p>商品名: <%= product.name %></p>
    <p>価格: <%= product.price %>円</p>
    <p>説明: <%= product.description %></p>
  </div>
<% end %>
```

このコードでは `product.get_image` を使って、商品画像が存在しない場合に `no_image.jpg` を表示するようにしています。

## 5. Routing の設定

# `config/routes.rb` にルーティングを追加
```ruby
Rails.application.routes.draw do
  resources :products, only: [:index]  # 商品一覧のルーティング
end
```

これにより、`/products` で商品一覧を表示できるようになります。

## 6. まとめ

本章では、以下の内容を実装しました。

- `Product` モデルの作成
- ActiveStorage を利用した画像の保存とデフォルト画像の設定
- `ProductsController` の `index` アクションの実装
- 商品一覧を表示する `index.html.erb` の作成
- ルーティングの設定

これにより、FruitShop の商品一覧ページを適切に表示できるようになりました。

