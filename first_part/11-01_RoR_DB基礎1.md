## 11 DB基礎

## 目次
+ [SQLとは](#SQLとは)

## SQLとは

### データベース（DB）とは
**データベース（DB）** とは、データを整理して保存し、効率的に管理するための仕組みです。
> **メモ**：詳しい解説は後ほど行います。

---

### SQLとデータベースの関係  
データベースは、単なるデータの入れ物ではなく、適切に操作できる仕組みが必要です。そこで使われるのが **SQL（Structured Query Language）** です。SQLは、データベースに対して「データを取り出したい」「新しいデータを追加したい」「データを更新したい」「不要なデータを削除したい」といった命令を伝えるための言語です。つまり、**データベースを管理・操作するための道具がSQL**だと考えると分かりやすいでしょう。

---

### SQLの特徴  

- **データベースの操作ができる**  
  SQLを使うことで、データを検索したり、追加・削除・更新が可能です。  

- **直感的な構文**  
  英語に近い記述ができるため、比較的学びやすい言語です。  

- **さまざまなデータベースで利用可能**  
  MySQL、PostgreSQL、SQLite、Oracle、SQL Serverなど、多くのデータベースで使用できます。

---

## SQLiteを使用したSQL学習
本テキストでは、SQLを学習するために**SQLite**を使用します。SQLiteは、設定が簡単で扱いやすいため、学習に適したデータベース管理システムです。以下の手順で環境を構築し、実際にSQLを試していきましょう。

---

#### SQLiteの導入方法
SQLiteは、軽量で手軽に利用できるデータベース管理システムです。以下の手順で導入できます。

1. **SQLiteのインストール**
    + **Windowsの場合**  
        [SQLiteの公式サイト](https://www.sqlite.org/download.html)から **Precompiled Binaries for Windows** の`sqlite-tools-win-x64-*******.zip`をダウンロードし、`C:\sqlite`に展開します。  
        
        <img src="images/DB基礎/SQL1.png" width="300px">  

        --- 

        次に、Windowsの環境変数設定画面を開きます。  

        + **Windows 10/11の場合**  
            画面左下の「スタートボタン」を**右クリック**して「システム」を選択します。  

            <img src="images/DB基礎/SQL2.png" width="300px">  

            「システム情報」が表示されたら、「システムの詳細設定」をクリックします。  

            <img src="images/DB基礎/SQL3.png" width="300px">  

            「システムのプロパティ」ダイアログが開いたら、「環境変数」をクリックします。  

            <img src="images/DB基礎/SQL4.png" width="400px">  

            「環境変数」ウィンドウが開いたら、次の手順でSQLiteのパスを追加します。  

            1. 「システム環境変数」のセクションで「Path」を選択し、「編集」をクリックします。  
                <img src="images/DB基礎/SQL5.png" width="400px">  

            1. 「新規」をクリックして、SQLiteの実行ファイルがあるディレクトリのパス（例：`C:\sqlite`）を入力します。  

                <img src="images/DB基礎/SQL6.png" width="400px">  

            1. 「OK」をクリックしてウィンドウを閉じて、再起動します。  

    + **macOSの場合**  
        Homebrewを使用してインストールできます。  

        ```sh
        brew install sqlite
        ```

    + **Linuxの場合**  
        多くのディストリビューションで、パッケージマネージャを利用してインストールできます。  

        ```sh
        sudo apt install sqlite3   # Debian/Ubuntu系
        sudo yum install sqlite    # RHEL/CentOS系
        ```

1. **SQLiteの起動**  
    インストール後、以下のコマンドでSQLiteを起動できます。
    ```sh
    sqlite3
    ```

1. **SQLiteのデータベース作成**  
    以下のコマンドで新しいデータベースファイルを作成できます。
    ```sh
    sqlite3 my_database.db
    ```

これで、SQLiteの環境が整いました。

---

#### ポイント  

- **データベース（DB）**: データを整理して保存し、効率的に管理する仕組み。
- **SQL（Structured Query Language）**: データベースの操作（検索、追加、更新、削除）を行うための言語。
- **SQLの特徴**:
  - データベースの操作ができる。
  - 直感的な英語に近い構文。
  - 複数のデータベースシステムで利用可能（MySQL、PostgreSQL、SQLite、Oracle、SQL Serverなど）。
  
- **SQLite**: 学習に適した軽量のデータベース管理システム。簡単に環境構築可能。

---

## データの操作（CRUD）

### データの追加（Create: INSERT）

最初にデータをデータベースに追加してみましょう。以下のSQL文で、`users` テーブルに新しいデータを追加します。

```sql
-- usersテーブルが存在しない場合、テーブルを作成します
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,  -- idは整数型で主キーとして設定、ユニークな識別子
    name TEXT,               -- nameは文字列型、ユーザーの名前を格納
    age INTEGER              -- ageは整数型、ユーザーの年齢を格納
);
```
```sql
-- ユーザーTaroの名前と年齢をusersテーブルに追加
INSERT INTO users (name, age) VALUES ('Taro', 25);

-- ユーザーJiroの名前と年齢をusersテーブルに追加
INSERT INTO users (name, age) VALUES ('Jiro', 30);

-- ユーザーSaburoの名前と年齢をusersテーブルに追加
INSERT INTO users (name, age) VALUES ('Saburo', 22);
```

まずは、このSQLを実行して、`users` テーブルにデータを追加しましょう。

#### **練習**  
以下のデータを追加してみてください。

| name  | age |
|-------|-----|
| Yuki  |  25 |
| Sora  |  30 |
| Miku  |  22 |
| Saki  |  28 |
| Kenta |  35 |

<details>
<summary>SQL例</summary>

```sql
INSERT INTO users (name, age) VALUES ('Yuki', 25);
INSERT INTO users (name, age) VALUES ('Sora', 30);
INSERT INTO users (name, age) VALUES ('Miku', 22);
INSERT INTO users (name, age) VALUES ('Saki', 28);
INSERT INTO users (name, age) VALUES ('Kenta', 35);
```
</details>

---

### データの取得（Read: SELECT）

データが追加されたら、それを取り出す方法を学びます。

```sql
SELECT * FROM users;
```

このSQL文を実行すると、`users` テーブルの全てのデータが取得できます。

  + **実行結果イメージ**
    | id  | name   | age |
    |-----|--------|-----|
    | 1   | Taro   | 25  |
    | 2   | Jiro   | 30  |
    | 3   | Saburo | 22  |
    | 4   | Yuki   | 25  |
    | 5   | Sora   | 30  |
    | 6   | Miku   | 22  |
    | 7   | Saki   | 28  |
    | 8   | Kenta  | 35  |


#### WHERE句

`WHERE`句を使うと、特定の条件に合致するデータだけを取得できます。例えば、`age`が30未満のユーザーのみを取得する場合、次のようにSQLを記述します。

```sql
SELECT * FROM users WHERE age < 30;
```

`WHERE`句を使用することで、データをフィルタリングして必要なものだけを選び出すことができます。

#### **練習**  
1. `age`が30以上のユーザーのみを表示するSQLを実行してみてください。  

    + **実行結果イメージ**  
      | id | name  | age |
      |----|-------|-----|
      | 2  | Jiro  |  30 |
      | 5  | Kenta |  35 |

    <details>
    <summary>SQL例</summary>

    ```sql
    SELECT * FROM users WHERE age >= 30;
    ```
    </details>

1. 名前が「Taro」のユーザーの**年齢だけ**を表示するSQLを実行してみてください。

    + **実行結果イメージ**  
      | age |
      |-----|
      |  25 |

    <details>
    <summary>SQL例</summary>

    ```sql
    SELECT age FROM users WHERE name = 'Taro';
    ```
    </details>
    
---

### データの更新（Update: UPDATE）

追加したデータを更新するには、`UPDATE` 文を使います。

```sql
UPDATE users SET age = 28 WHERE name = 'Taro';
```

これにより、「Taro」の年齢が28に変更されます。

+ **更新前**
    | id  | name   | age |
    |-----|--------|-----|
    | 1   | Taro   | 25  |

+ **更新後**
    | id  | name   | age |
    |-----|--------|-----|
    | 1   | Taro   | 28  |

#### **練習**  
名前「Saburo」の年齢を24に更新してみてください。

+ **更新前**
    | id  | name   | age |
    |-----|--------|-----|
    | 1   | Taro   | 22  |

+ **更新後**
    | id  | name   | age |
    |-----|--------|-----|
    | 3   | Saburo | 24  |

    <details>
    <summary>SQL例</summary>

    ```sql
    UPDATE users SET age = 24 WHERE name = 'Saburo';
    ```
    </details>

---

### データの削除（Delete: DELETE）

不要なデータを削除するには、`DELETE` 文を使います。

```sql
DELETE FROM users WHERE name = 'Taro';
```

これにより、「Taro」という名前のユーザーが削除されます。

+ **実行結果イメージ**  
    | id  | name   | age |
    |-----|--------|-----|
    | 2   | Jiro   | 30  |
    | 3   | Saburo | 24  |
    | 4   | Yuki   | 25  |
    | 5   | Sora   | 30  |
    | 6   | Miku   | 22  |
    | 7   | Saki   | 28  |
    | 8   | Kenta  | 35  |

#### **練習**  
「Jiro」という名前のユーザーを削除してみてください。
+ **実行結果イメージ**  
    | id  | name   | age |
    |-----|--------|-----|
    | 3   | Saburo | 24  |
    | 4   | Yuki   | 25  |
    | 5   | Sora   | 30  |
    | 6   | Miku   | 22  |
    | 7   | Saki   | 28  |
    | 8   | Kenta  | 35  |

    <details>
    <summary>SQL例</summary>

    ```sql
    DELETE FROM users WHERE name = 'Jiro';
    ```
    </details>

---

#### ポイント  

- **データ操作（CRUD）**:
  - **Create**（追加）  
    `INSERT INTO` を使用してデータを追加。
  - **Read**（取得）  
    `SELECT` を使用してデータを取得。`WHERE`句で条件を絞れる。
  - **Update**（更新）  
    `UPDATE` を使って既存データを変更。
  - **Delete**（削除）  
    `DELETE` を使って不要なデータを削除。