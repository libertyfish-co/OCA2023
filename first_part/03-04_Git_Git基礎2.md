# 3 Git基礎

## 目次
  - [ワーキングディレクトリと作業ブランチについて](#ワーキングディレクトリと作業ブランチについて)
  - [作業のやりなおしについて](#作業のやりなおしについて)
  - [GitHub Flowとは](#gitHubflowとは)
  - [Codeとは](#gitHubflowとは)

### ワーキングディレクトリと作業ブランチについて

- __作業ブランチの作成__  
  前の項目で作成したリモートリポジトリ**FizzBuzz**はブランチが`main`のみでした。  
  今回はプログラムの内容を追加するためのブランチを作成してみましょう。    
  ブランチの作成と作業ブランチの切り替え（ワーキングディレクトリへの移動）は、以下のコマンドを使用して行います。  

    ```sh
    $ git branch call_fizzbuzz   # call_fizzbuzzブランチの作成 
    $ git checkout call_fizzbuzz # call_fizzbuzzブランチへ切り替え
    ```

  上記1行目の`git branch`コマンドで作業ブランチを作成し、2行目の`git checkout`コマンドで作業ブランチを切り替えています。
  また、以下のようにブランチの作成と切り替えを１つのコマンドにまとめることも出来ます。  

    ```sh
    $ git checkout -b call_fizzbuzz # -b は branch の略称
    ```
    <br>

  ブランチの切り替えですが、Gitのバージョン2.23以降ではブランチの切り替えに特化した`git switch`が追加されました。  
  `git checkout`にはブランチの切り替え以外にも作業ディレクトリの取り消しなど様々な機能が備わっています。そのため、使用方法がややこしかったり、誤った操作を行いやすいといった問題がありました。  
  そうした点からブランチの切り替えに特化した`git switch`が導入されました。以前同様に`git checkout`でブランチの切り替えは可能ですが、`git switch`が導入されたことによって役割が明確に分かれ、使いやすくなりました。  
  
  Gitのバージョンが2.23移行であれば、下記のコマンドが実行できます。

    ```sh
    $ git switch <切り替えたいブランチ名>
    ```

  またブランチの作成は`-c`もしくは`--create`オプションを追加することで実行できます。

    ```sh
    $ git switch -c <作りたいブランチ名>
    ```

  <br>

- __ブランチの一覧表示__  

  `git branch`コマンドの引数を指定せずに実行すると、ブランチの一覧を表示することができます。現在のブランチは頭に ***（アスタリスク）** がついています。

  ```sh
  $ git branch
    * call_fizzbuzz # 現在いるブランチ
    main            # 他に存在するブランチ
  ```

---

### 作業のやりなおしについて

開発作業中に何かをやり直したくなる場面はよくあります。ここでは、行った変更を取り消すための基本的なコマンドについて説明します。  


- ローカルリポジトリの作業ブランチへの変更を取り消す

  ```sh
  $ git checkout .
  ```

  `git checkout <ファイル名>`とすると変更の取り消しを行いたいファイルのみ取り消す事ができます。  
  `git checkout .`の場合は、作業ブランチで変更した内容をすべて取り消してはくれますが、新規追加したファイルは削除されません。  
  完全にもとに戻したい場合は別途削除する必要があります。

  ```sh
  $ git clean -df .
  ``` 

- addの取り消し
  
  ```sh
  $ git reset HEAD .
  ```
      
  ステージングエリアにあるファイルを削除するコマンドです。ただ、ファイルの変更内容は残ります。つまり変更内容を残したまま、コミットしていない状態に戻すことができます。  
  
- commitの取り消し

  ```sh
  $ git reset <mode> <commit> .
  ```
  
  `mode`のデフォルトは`--mixed`なので、変更したファイルはすべて変わらず、gitの履歴のみ変更されます。  
  変更したファイルも含めてすべて指定したのcommitの状態に戻したいので場合には`mode`に`--hard`を指定して下さい。
  新規追加したファイルは`--hard`を指定したとしても削除されず、残ったままになるため 完全に元に戻したいのであれば別途削除する必要があります。


- リモートリポジトリにpushした内容を取り消す

  ```sh
  $ git revert [<commit>]
  $ git push
  ```

---

### GitHub Flowとは

#### 概要

  `GitHub Flow`は、GitとGitHubを利用したワークフローで、とてもシンプルな構造であるにも関わらず、生産性を大きく向上させる効果を持っています。  
  コマンドライン上の操作だけではなく、GUIを用いた仕組みを取り入れることで、Gitに慣れていない人でも比較的ハードルの低いワークフローになっています。    

#### 基本原則

  - mainブランチのものは何であれデプロイ可能である
  - 新しい何かに取り組む際は、説明的な名前のブランチをmainから作成する（例: new-oauth2-scopes）
  - 作成したブランチにローカルでコミットし、サーバー上の同じ名前のブランチにも定期的に作業内容をpushする
  - フィードバックや助言が欲しい時、ブランチをマージしてもよいと思ったときは、 プルリクエスト を作成する
  - 他の誰かがレビューをして機能にOKを出してくれたら、あなたはコードをmainへマージすることができる
  - マージをしてmainへpushしたら、直ちにデプロイをする

#### 実際のワークフロー

  最初にもある通り、このワークフローはとてもシンプルな構造になっています。  
  具体的には、基本原則を一通りなぞっていけば、それがこのワークフローの全てだと言える程です。  
  以下がワークフローの詳細です。

![ワークフロー詳細](images/2-2-2-1.png)

この教材での開発はこのワークフローを使用して進めていくことになります。  

---

### GitHub Codespaces

### 注意：GitHub Codespacesは使用の無料枠に上限があります。メインの開発環境として使う場合は十分に気を付けましょう。


#### GitHub Codespacesとは
**GitHub Codespaces** (以下 **Codespaces**) はGitHubがクラウド上に提供している開発環境です。機能的にもUI的にも Visual Studio Code とほぼ同じなため、普段 Visual Studio Code を利用されている方であれば、すぐに作業に入ることができます。  

---

#### 特徴
Codespacesには多くの利点が存在します。今回はその内の何点かについて次にまとめています。    

 - __ブラウザ上で利用できる__
   Codespacesはインターネットに接続さえできれば、**ブラウザ上で利用可能**です。そのため、端末が違ってもGitHubにログインさえできれば、作業を行うことができます。

 - __環境構築を省略__
   **必要な依存関係やツールを事前に設定した状態で**開発環境が瞬時に立ち上がります。そのため、環境構築の手間や時間を省けます。

 - __OSに縛られない__
   ブラウザさえ起動すれば環境が整うため、WindowsやiOSなどのOSが違う場合でも同様に作業を行うことができます。  

他にも多くの利点があります。もし気になる方がおられれば、後ほど調べていただければと思います。  

---

#### 注意
Codespacesは大変便利ですが、いくつか注意事項があります。その内、特に覚えていてほしい点を次に記載します。

- __無料枠に上限がある__  
  上記でも説明しましたが、Codespacesは無料で使えるコア時間およびストレージ量に上限があります。  
  GitHubのアカウントが無料プランの場合、 コア時間は作成したCodespaces全体で **1か月で120時間まで** が無料枠になります。そのため毎日8時間ずつCodespacesを使用した場合、**8日で上限** に届きます。  
  また、ストレージ量は **1か月で15GBまで** が無料になります。こちらも作成したCodespaces全体の合計数値です。  
  日々長時間の作業をCodespacesで行う場合は、有料になることを覚えておきましょう。  

- __環境を削除するとCodespaceの中身も消える__  
  CodespacesはGitHubが用意した環境を利用しています。この環境によってどこからでも利用できますが、環境を削除すると環境内の内容は全て削除されてしまいます。  
  Codespaces上で編集を行った場合は必ずGitHubなどにpushしておきましょう。  

- __放置した場合もCodespaceが削除される__  
  先ほどの話しと繋がりますが、Codespacesを構わず置いていた場合、デフォルトでは30日後に自動削除されます。環境が削除されるため、手動で削除した場合と同様に中身も消えてしまいますので注意しましょう。  

Codespacesは必要以上に多くの環境を長時間立ち上げたり、大きいファイルを多数扱うなどを行うと**無料枠がすぐに消費**され、課金対象になるため使用する場合は十分注意しましょう。  

---

#### 利用方法
ここからは実際にCodespacesの利用方法を説明していきます。今回は前に作成したリモートリポジトリ**FizzBuzz**をもとに行っていきます。

 1. リポジトリ**FizzBuzz**のトップページに移動してから**Code**ボタン（①）をクリックします。そうすると下の図のような状態になるため、**Create codespace on main**ボタン（②）をクリックしてください。  

    <img src="images/Git基礎/codespaces_初期作成.png"> 

 2. 画面が遷移されて、少し待つと下の図のようになります。これでこのリポジトリのCodespaceが作成されて、利用可能になります。Codespaceを閉じたい時はタブを閉じるか前の画面に戻ると停止状態になります。
   <img src="images/Git基礎/codespaces_作業画面.png"> 

 3. 閉じた後にリポジトリのトップページに戻って再度**Code**ボタン（①）をクリックすると、下の図のようになります。最初は無かった部分が表示されているのが分かります。この場合ですと**silver acorn**をクリックすることで作成したCodespaceを再び開くことが可能です。  
   <img src="images/Git基礎/codespaces_作成後.png"> 

 4. 作成したCodespaceを削除したい場合は、Codespaceの右側にある`・・・`をクリックするとバーが表示されるため、一番下の`Delete`をクリックして削除できます。  
   <img src="images/Git基礎/codespaces_削除方法.png">