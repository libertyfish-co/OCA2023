# FruitShop 商品投稿機能の実装

## データベース設計

### products テーブルの作成

```ruby
# products テーブルを作成
create_table :products do |t|
  t.string :name, null: false  # 商品名（必須）
  t.text :description          # 商品説明
  t.integer :price, null: false # 価格
  t.timestamps                 # 作成日時と更新日時
end
```

## 1. Model の実装

商品投稿を行う Product モデルを作成

```ruby
class Product < ApplicationRecord
  # バリデーションを追加
  validates :name, presence: true  # 商品名は必須
  validates :price, presence: true # 価格は必須
end
```

## 2. Controller の実装

商品を新規作成する new と create アクションを追加

```ruby
class ProductsController < ApplicationController
  # 新規作成フォームを表示
  def new
    @product = Product.new  # 新しい商品を作成するためのインスタンスを生成
  end

  # 商品を保存する
  def create
    @product = Product.new(product_params)  # フォームから送信されたパラメータを基に新しい商品を作成
    if @product.save
      # 商品が正常に保存された場合、商品一覧ページへリダイレクト
      redirect_to products_path, notice: '商品が正常に投稿されました。'
    else
      # 保存に失敗した場合、再度フォームを表示
      render :new
    end
  end

  private

  # パラメータの強制的なフィルタリング
  def product_params
    params.require(:product).permit(:name, :description, :price)  # name, description, price のみ許可
  end
end

```

## 3. View の実装

商品投稿フォームを作成 `new.html.erb`


```erb
<h1>商品投稿</h1>

  <div>
    <%= form.label :name %>  <!-- 商品名ラベル -->
    <%= form.text_field :name %>  <!-- 商品名入力フォーム -->
  </div>

  <div>
    <%= form.label :description %>  <!-- 商品説明ラベル -->
    <%= form.text_area :description %>  <!-- 商品説明入力フォーム -->
  </div>

  <div>
    <%= form.label :price %>  <!-- 価格ラベル -->
    <%= form.number_field :price %>  <!-- 価格入力フォーム -->
  </div>

  <div>
    <%= form.submit "商品を投稿" %>  <!-- 商品投稿ボタン -->
  </div>
<% end %>

```

商品一覧を表示する `index.html.erb`

```erb
<h1>商品一覧</h1>

<% @products.each do |product| %>
  <div>
    <p>商品名: <%= product.name %></p>
    <p>価格: <%= product.price %>円</p>
    <p>説明: <%= product.description %></p>
  </div>
<% end %>

<%= link_to '新規商品投稿', new_product_path %>
```

## 4. Routing の設定

`config/routes.rb` にルーティングを追加

```ruby
Rails.application.routes.draw do
  resources :products, only: [:index, :new, :create]  # 商品一覧、投稿フォーム、投稿処理
end
```

これにより、`/products` で商品一覧を表示し、`/products/new` で商品投稿フォームを表示できるようになります。

## 5. まとめ

本章では、以下の内容を実装しました。

- Product モデルの作成とバリデーションの設定
- ProductsController の new と create アクションの実装
- 商品投稿フォームの作成
- 商品一覧表示ページの作成
- ルーティングの設定

これにより、FruitShop の商品投稿機能を適切に実装できるようになりました。