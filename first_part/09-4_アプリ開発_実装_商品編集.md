# FruitShop 商品編集の実装

ウェブアプリケーションで商品を編集する際、以下のような手順で処理されます。

1. **コントローラーの作成**  
 商品を編集するための `edit` アクションと `update` アクションを実装します。

1. **ビューの作成**  
 商品編集フォームを表示するための `edit.html.erb` ビューを作成します。

1. **ルーティングの設定**  
 商品編集ページへのルーティングを設定します。

このように、商品編集機能には「データベースの準備」「モデルの作成」「コントローラーの作成」「ビューの作成」「ルーティングの設定」のステップが含まれます。  
それでは、各ステップを実装するための流れを詳しく見ていきましょう。

## 実装の流れ

ウェブアプリで商品を編集するためには、以下の手順で実装を進めます。

### 1. コントローラーの作成

商品を編集する `ProductsController` を作成します。

```ruby
# app/controllers/products_controller.rb
class ProductsController < ApplicationController
  # 商品編集フォームを表示するアクション
  def edit
    @product = Product.find(params[:id])
  end

  # 商品情報を更新するアクション
  def update
    @product = Product.find(params[:id])
    if @product.update(product_params)
      redirect_to products_path # 商品一覧にリダイレクト
    else
      render :edit  # 失敗時に編集画面に戻る
    end
  end

  private

  # 許可されたパラメータを設定するメソッド
  def product_params
    params.require(:product).permit(:name, :description, :price)
  end
end
```


<details>
<summary>現在の商品コントローラー</summary>

```ruby
class ProductsController < ApplicationController
  def new
    @product = Product.new
  end

  def create
    @product = Product.new(product_params)
    if @product.save
      redirect_to root_path
    else
      render :new
    end
  end

  def index
    @products = Product.all
  end

  def show
    @product = Product.find(params[:id])
  end

  def edit
    @product = Product.find(params[:id])
  end

  def update
    @product = Product.find(params[:id])
    if @product.update(product_params)
      redirect_to products_path
    else
      render :edit
    end
  end

  private

  def product_params
    params.require(:product).permit(:name, :description, :price)
  end
end
```

</details>

### 2. ビューの作成

商品編集フォームを表示する `edit.html.erb` を作成します。

```erb
<!-- app/views/products/edit.html.erb -->
<%= form_with(model: @product, local: true) do |form| %>
  <div>
    <%= form.label :name, "商品名" %>
    <%= form.text_field :name %>
  </div>
  <div>
    <%= form.label :description, "説明" %>
    <%= form.text_area :description %>
  </div>
  <div>
    <%= form.label :price, "価格" %>
    <%= form.number_field :price %>
  </div>
  <div>
    <%= form.submit "更新" %>
  </div>
<% end %>
```

### 3. ルーティングの設定

商品編集ページへのルーティングを設定します。

```diff
+ get 'products/:id/edit' => 'products#edit', as: 'edit_product'
+ patch 'products/:id' => 'products#update'
```

```ruby
# app/config/routes.rb
Rails.application.routes.draw do
  get 'products/new'  # 商品投稿フォームを表示
  post 'products' => 'products#create'  # 商品を保存する
  get 'products' => 'products#index'  # 商品一覧を表示する
  get 'products/:id' => 'products#show', as: 'product'  # 商品詳細を表示する
  get 'products/:id/edit' => 'products#edit', as: 'edit_product'  # 商品編集フォームを表示
  patch 'products/:id' => 'products#update'  # 商品を更新する
end
```

### まとめ

- `ProductsController` の `edit` および `update` アクションの実装
- 商品編集フォームを表示する `edit.html.erb` の作成
- ルーティングの設定

これにより、FruitShop の商品編集ページを適切に実装できるようになります。