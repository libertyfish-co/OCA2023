# 2 実践Rubyプログラム

## 目次
+ [RPGバトルについて](#rpgバトルについて)

<br>

---

### ラウンドをループさせよう
前セクションでの動作テストが問題なかったら、`start`メソッド内の処理をループさせましょう。加えて、今が何ラウンド目なのかを表示させてみます。

```rb
# ゲーム開始処理
def start
  round = 0   # ラウンド数
  
  # 開始メッセージ
  puts "\n◆◆◆ モンスターが現れた！ ◆◆◆"
  
  loop do
    # ラウンド数
    round += 1
    puts "\n=== ラウンド #{round} ==="

    # ステータス表示
    show_stts(@heroes)  # 勇者パーティ表示
    show_stts(@mnstrs)  # モンスターパーティ表示

    # 勇者パーティのターン
    hero_turn()
    return if @esc_flg  # 逃げた場合は終了

    # モンスターのターン
    mnst_turn()
  end
end
```

勝敗はつきませんが、ゲームとして成り立つループが完成します。

<br>

---

### キャラクターを増やしてみよう
基本的な構造は出来上がってきたので、キャラクターを追加してみます。  
現在のパーティ作成メソッド(`create_heroes`、`create_mnstrs`)ではそれぞれ1人までしかキャラクターを定義できません。  
では、これ以上のメソッドを増やさず、複数のキャラクターのオブジェクトを作成して戻り値として返すにはどうしたらよいのでしょうか？少し考えてみましょう。

+ 勇者パーティに追加するキャラクター
  + 魔法使い
  + HP：20
  + こうげき力：8
  + 魔法こうげきを使用
+ モンスターパーティに追加するキャラクター
  + ゴブリン
  + HP：25
  + こうげき力：6
  + 通常こうげきを使用


```rb
# 現在のコード

# 勇者パーティの作成
def create_heroes(hero_nm)
  Character.new(hero_nm, 30, 6, Constants::ATK_TYPE_NORMAL, true)  # プレイヤーが操作する勇者
end

# モンスターパーティの作成
def create_mnstrs
  Character.new('オーク', 30, 8, Constants::ATK_TYPE_NORMAL)   # オーク(CPU)
end
```
>**ヒント**：オブジェクトは配列に格納させることができます。

<details>
<summary>コード例</summary>

```rb
# 勇者パーティの作成
def create_heroes(hero_nm)
  [
    Character.new(hero_nm, 30, 6, Constants::ATK_TYPE_NORMAL, true),  # プレイヤーが操作する勇者
    Character.new('魔法使い', 30, 6, Constants::ATK_TYPE_MAGIC)        # 魔法使い(CPU)
  ] 
end

# モンスターパーティの作成
def create_mnstrs
  [
    Character.new('オーク', 30, 8, Constants::ATK_TYPE_NORMAL),    # オーク(CPU)
    Character.new('ゴブリン', 25, 6, Constants::ATK_TYPE_NORMAL)   # ゴブリン(CPU)
  ]
end
```

このように、配列の中にオブジェクトを格納することができました。
</details>

配列の中にオブジェクトを格納したので、それぞれ一部コードの改修が必要になります。  
以下はその例です。

```rb
# ステータス表示
# 変更前
def show_stts(chrct)
    puts "・【#{chrct.nm}】 HP：#{chrct.hp} こうげき力：#{chrct.atk_pwr}"
end

# 変更後
def show_stts(prty)
    prty.each { |chrct| puts "・【#{chrct.nm}】 HP：#{chrct.hp} こうげき力：#{chrct.atk_pwr}"}
end
```

```rb
# ステータス表示
# 変更前
def show_stts(chrct)
  puts "・【#{chrct.nm}】 HP：#{chrct.hp} こうげき力：#{chrct.atk_pwr}"
end

# 変更後
def show_stts(prty)
  prty.each { |chrct| puts "・【#{chrct.nm}】 HP：#{chrct.hp} こうげき力：#{chrct.atk_pwr}"}
end
```

```rb
# こうげき共通
def atk(chrct, atk_trgt)  # (行動をするキャラクター, こうげき対象)
  # こうげきメッセージ
  puts "#{chrct.nm}のこうげき！"
  
  # ダメージ処理
  dmg = chrct.atk()       # ダメージ計算
  atk_trgt.take_dmg(dmg)  # ダメージ反映

  puts "#{atk_trgt.nm} に #{dmg} のダメージ！"  # ダメージ処理
end

```