## 13.2 Ruby on Rails：ECサイトの開発 検索1

ここでは商品一覧や注文一覧からタイトルや著者、購入者、状態から検索が行える機能を追加します。
Webアプリケーション開発では、このような検索機能を実装することが多くあります。そこで検索機能を簡単に実装するために`ransack`というgemを使って実装していきます。

### 13.2.1 ransackのしくみ

`ransack`は、検索条件を入力するフォームに機能を追加します。

たとえば、`ransack`を使用せずに検索機能を作成する場合、フォームには検索に利用する条件を設定し、実際に検索のアクションが実行されたときに、コントローラが検索条件の情報を利用して、条件と一致する、条件より大きい、条件と不一致、条件を含むなどをロジックで記述します。

`ransack`を使用することで、フォームには検索項目と検索条件を同時に記述することができ、コントローラでは、その検索条件を処理する文を追加するだけで、検索条件を組み立てるプログラムを記述する必要がなくなり、プログラムの可読性や保守性を高めることができます。

### 13.2.2 ransackの使い方
`ransack`をインストールすると各種モデルに`ransack`というメソッドが追加されます。
検索条件を引数にして`ransack`メソッドを呼び出すと`Ransack::Search`オブジェクトが返ってきます。
そのオブジェクトに対して`result`メソッドを呼び出すことで検索結果を取得できます。

```rb
def index
  @q = User.ransack params[:q]
  @users = @q.result
end
```

検索条件は画面から入力します。
その画面のフォームを作成するために`ransack`では`search_form_for`というViewHelperが準備されています。

```html
<%= search_form_for @q do |f| %>
  <%= f.text_field :name_cont %>
  <%= f.submit %>
<% end %>
```
